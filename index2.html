<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Ch√∫c m·ª´ng 20/10</title>
  <link href="https://fonts.googleapis.com/css2?family=Mali:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
  <style>
    /* (gi·ªØ nguy√™n CSS c·ªßa b·∫°n) */
    *{margin:0;padding:0;box-sizing:border-box}
    body{margin:0;padding:0;background:linear-gradient(135deg,#fffafa);overflow:hidden;font-family:"Mali",cursive;height:100vh;position:relative}
    .center-message{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,rgba(255,255,255,0.95),rgba(255,240,245,0.9));padding:40px 50px;border-radius:30px;font-size:1.6rem;font-weight:400;color:#c2185b;text-align:center;box-shadow:0 20px 60px rgba(216,27,96,0.3),0 0 0 1px rgba(255,255,255,0.5) inset;z-index:1;max-width:90%;animation:pulse 3s ease-in-out infinite;backdrop-filter:blur(10px);border:2px solid rgba(255,255,255,0.3)}
    @keyframes pulse{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.05)}}
    .center-message strong{display:block;font-size:2rem;margin-bottom:15px;font-weight:700;background:linear-gradient(45deg,#d81b60,#f06292,#d81b60);background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:gradient 3s ease infinite}
    @keyframes gradient{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
    .overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);backdrop-filter:blur(5px);z-index:99;display:none;animation:fadeInOverlay 0.3s ease}
    @keyframes fadeInOverlay{from{opacity:0}to{opacity:1}}
    .overlay.active{display:block}
    .popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.8);background:linear-gradient(135deg,#ffffff 0%,#fff5f8 100%);border-radius:25px;box-shadow:0 25px 80px rgba(216,27,96,0.4);padding:30px;text-align:center;z-index:100;width:90%;max-width:400px;display:none;animation:popupShow 0.5s cubic-bezier(0.68,-0.55,0.265,1.55) forwards;border:3px solid rgba(255,255,255,0.8)}
    @keyframes popupShow{from{opacity:0;transform:translate(-50%,-50%) scale(0.5) rotate(-5deg)}to{opacity:1;transform:translate(-50%,-50%) scale(1) rotate(0deg)}}
    .popup img{max-width:100%;border-radius:15px;margin-bottom:20px;box-shadow:0 10px 30px rgba(0,0,0,0.2);border:3px solid white}
    .popup p{font-size:1.1rem;color:#d81b60;line-height:1.6;margin-bottom:20px;font-weight:500}
    .popup button{margin-top:10px;background:linear-gradient(135deg,#d81b60 0%,#f06292 100%);color:white;border:none;padding:12px 30px;border-radius:25px;cursor:pointer;font-size:1rem;font-weight:600;box-shadow:0 5px 20px rgba(216,27,96,0.4);transition:all .3s ease}
    .popup button:hover{background:linear-gradient(135deg,#ad1457 0%,#e91e63 100%);transform:translateY(-2px);box-shadow:0 8px 25px rgba(216,27,96,0.5)}
    .falling-letter{position:absolute;top:-100px;width:50px;height:auto;animation:fall linear;cursor:pointer;user-select:none;z-index:2;animation-duration:8s;filter:drop-shadow(0 5px 10px rgba(0,0,0,0.2));transition:transform .3s ease}
    .falling-letter:hover{transform:scale(1.2) rotate(10deg);filter:drop-shadow(0 10px 20px rgba(216,27,96,0.4))}
    @keyframes fall{0%{transform:translateY(0) translateX(0) rotate(0deg);opacity:1}20%{transform:translateY(20vh) translateX(-20px) rotate(-10deg)}40%{transform:translateY(40vh) translateX(15px) rotate(8deg)}60%{transform:translateY(60vh) translateX(-15px) rotate(-6deg)}80%{transform:translateY(80vh) translateX(10px) rotate(4deg)}100%{transform:translateY(100vh) translateX(0) rotate(0deg);opacity:0.3}}
    @keyframes letterClick{0%{transform:scale(1) rotate(0deg)}50%{transform:scale(1.3) rotate(360deg)}100%{transform:scale(0) rotate(720deg)}}
    .letter-clicked{animation:letterClick .6s ease-out forwards !important}
    .heart{position:absolute;transform:translate(-50%,-50%);animation:explode 2s ease-out forwards;pointer-events:none;user-select:none}
    @keyframes explode{0%{transform:translate(-50%,-50%) translate(0,0);opacity:1}100%{transform:translate(-50%,-50%) translate(var(--dx),var(--dy)) scale(1.5);opacity:0}}
    .center-gif{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:150px;max-width:40vw;z-index:10;pointer-events:none}
    @media(max-width:768px){.center-message{width:calc(100% - 20px);max-width:none;padding:20px 15px;font-size:1.1rem;border-radius:20px;left:50%;transform:translate(-50%,-50%)}.center-message strong{font-size:1.3rem;margin-bottom:10px}.popup{width:90%;padding:20px;border-radius:20px}.popup img{border-radius:10px;margin-bottom:15px}.popup p{font-size:1rem;line-height:1.5}.popup button{padding:10px 25px;font-size:.95rem}.falling-letter{width:40px;animation-duration:9s}.heart{font-size:18px!important}.falling-letter::before{content:'';position:absolute;top:-10px;left:-10px;right:-10px;bottom:-10px}}
  </style>
</head>
<body>
  <div class="center-message">
    <strong>Ch√∫c m·ª´ng em iu ng√†y 20-10</strong>
    <span id="centerText">
      Ng√†y d√†nh cho c√¥ng ch√∫a<br>
      Mong em lu√¥n r·∫°ng r·ª° nh∆∞ hoa!
    </span>
  </div>

  <!-- GIF trung t√¢m: src s·∫Ω ƒë∆∞·ª£c set ƒë·ªông -->
  <img id="centerGif" src="" alt="GIF" class="center-gif" />

  <div class="popup" id="popup">
    <div class="popup-content">
      <img id="popupImage" src="" alt="L·ªùi ch√∫c">
      <p id="popupMessage">L·ªùi ch√∫c ·ªü ƒë√¢y</p>
    </div>
  </div>
  <div class="overlay" id="overlay"></div>

  <!-- audio: src set ƒë·ªông -->
  <audio id="player" src="" preload="auto"></audio>

  <script>
    // -----------------------------
    // Helper: th·ª≠ c√°c ƒë∆∞·ªùng d·∫´n, ch·ªçn c√°i t·ªìn t·∫°i
    // -----------------------------
    function testUrl(url) {
      return new Promise((resolve) => {
        // V·ªõi audio v√† image d√πng c√πng ph∆∞∆°ng ph√°p: t·∫°o element ki·ªÉm tra onload/onerror
        const ext = url.split('.').pop().toLowerCase();
        if (['mp3','wav','ogg','m4a'].includes(ext)) {
          const a = document.createElement('audio');
          a.src = url;
          a.addEventListener('canplaythrough', () => resolve(url), { once: true });
          a.addEventListener('error', () => resolve(null), { once: true });
        } else {
          const img = new Image();
          img.onload = () => resolve(url);
          img.onerror = () => resolve(null);
          img.src = url;
        }
      });
    }

    async function findFirstWorking(candidates) {
      for (let i = 0; i < candidates.length; i++) {
        const url = candidates[i];
        if (!url) continue;
        const ok = await testUrl(url);
        if (ok) return ok;
      }
      return null;
    }

    // T·∫°o danh s√°ch ·ª©ng vi√™n: th·ª≠ ./assets/xxx, ./xxx (root), v√† t√™n t·ªáp (n·∫øu c·∫ßn)
    function candidatesFor(filename) {
      return [
        `./assets/${filename}`,
        `assets/${filename}`,
        `./${filename}`,
        `${filename}`
      ];
    }

    // -----------------------------
    // N·ªôi dung (b·∫°n ƒë·ªïi t√™n file ·∫£nh/nh·∫°c ·ªü ƒë√¢y n·∫øu mu·ªën)
    // -----------------------------
    const messages = [
      { img: "Lanh1.jpg", text: "Ch√∫c Lanh th√∫i c·ªßa anh lu√¥n vui v·∫ª, xinh ƒë·∫πp v√† ng·∫≠p tr√†n y√™u th∆∞∆°ng nh√°!" },
      { img: "Lanh8.jpg", text: "Mong m·ªói ng√†y em ƒë·ªÅu c∆∞·ªùi xinh v√† y√™u ƒë·ªùi nh∆∞ n√†y." },
      { img: "Lanh7.jpg", text: "L·∫ßn ƒëi bi·ªÉn sau c·ªßa em s·∫Ω l√† ƒëi v·ªõi anh." },
      { img: "Lanh5.jpg", text: "Bao gi·ªù g·∫∑p nhau ph·∫£i ch·ª•p th·∫≠t nhi·ªÅu ·∫£nh c√πng nhau ƒë√≥a." },
      { img: "Lanh9.jpg", text: "B√© n√†y s·∫Ω m√£i lu√¥n ƒë√°ng y√™u nh∆∞ n√†y nh√°aaaa iu qu√°." }
    ];

    // ·∫£nh r∆°i (danh s√°ch t·ªáp, c√≥ th·ªÉ upload ·ªü root ho·∫∑c assets)
    const letterImageFiles = ["letters.png","q3.png","h1.png","h3.png","t2.png","t5.png"];
    // GIF trung t√¢m
    const centerGifFile = "mewmew.gif";
    // nh·∫°c n·ªÅn
    const musicFile = "c.mp3";

    // sau khi resolve, s·∫Ω ch·ª©a ƒë∆∞·ªùng d·∫´n d√πng th·ª±c t·∫ø
    let resolvedLetterImages = [];
    let resolvedCenterGif = null;
    let resolvedMusic = null;

    // -----------------------------
    // Resolve t·∫•t c·∫£ ƒë∆∞·ªùng d·∫´n tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu animation
    // -----------------------------
    async function prepareAssets() {
      // resolve letter images
      resolvedLetterImages = [];
      for (const f of letterImageFiles) {
        const url = await findFirstWorking(candidatesFor(f));
        if (url) resolvedLetterImages.push(url);
      }

      // center gif
      resolvedCenterGif = await findFirstWorking(candidatesFor(centerGifFile));
      if (resolvedCenterGif) document.getElementById('centerGif').src = resolvedCenterGif;

      // music
      resolvedMusic = await findFirstWorking(candidatesFor(musicFile));
      if (resolvedMusic) {
        const player = document.getElementById('player');
        player.src = resolvedMusic;
      }

      // resolve popup images inside messages: convert file name -> real url
      for (let i = 0; i < messages.length; i++) {
        const real = await findFirstWorking(candidatesFor(messages[i].img));
        messages[i].realImg = real; // n·∫øu null th√¨ khi showPopup s·∫Ω x·ª≠ l√Ω
      }

      // n·∫øu kh√¥ng c√≥ b·∫•t k·ª≥ ·∫£nh r∆°i n√†o th√¨ b·ªè interval
      if (resolvedLetterImages.length === 0) {
        console.warn('No falling letter images found.');
      }
    }

    // -----------------------------
    // UI logic (gi·ªØ nguy√™n c·ªßa b·∫°n nh∆∞ng d√πng c√°c ƒë∆∞·ªùng d·∫´n ƒë√£ resolve)
    // -----------------------------
    let currentMessageIndex = 0;
    const popup = document.getElementById("popup");
    const overlay = document.getElementById("overlay");
    const popupImage = document.getElementById("popupImage");
    const popupMessage = document.getElementById("popupMessage");
    const centerText = document.getElementById("centerText");

    function createHeartExplosion(x, y) {
      const hearts = ['üíó'];
      const numHearts = 12;
      for (let i = 0; i < numHearts; i++) {
        const heart = document.createElement('div');
        heart.classList.add('heart');
        heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
        const angle = (Math.PI * 2 / numHearts) * i;
        const distance = Math.random() * 80 + 40;
        heart.style.left = x + 'px';
        heart.style.top = y + 'px';
        heart.style.setProperty('--dx', Math.cos(angle) * distance + 'px');
        heart.style.setProperty('--dy', Math.sin(angle) * distance + 'px');
        heart.style.fontSize = (Math.random() * 10 + 20) + 'px';
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 2000);
      }
    }

    function createFallingLetter() {
      if (resolvedLetterImages.length === 0) return;
      const letter = document.createElement("img");
      const randomImage = resolvedLetterImages[Math.floor(Math.random() * resolvedLetterImages.length)];
      letter.src = randomImage;
      letter.classList.add("falling-letter");
      letter.style.left = Math.random() * (window.innerWidth - 50) + "px";
      letter.addEventListener("click", (e) => {
        createHeartExplosion(e.clientX, e.clientY);
        letter.classList.add('letter-clicked');
        setTimeout(() => showPopup(), 300);
      });
      document.body.appendChild(letter);
      setTimeout(() => letter.remove(), 8000);
    }

    function showPopup() {
      const message = messages[currentMessageIndex];
      // n·∫øu ƒë√£ resolve realImg th√¨ d√πng, n·∫øu kh√¥ng th√¨ th·ª≠ c√°c candidate ngay l√∫c n√†y
      if (message.realImg) {
        popupImage.src = message.realImg;
      } else {
        // fallback th·ª≠ candidate list synchronously (kh√¥ng ch·∫∑n UI): ch·ªçn ƒë·∫ßu ti√™n t·ªìn t·∫°i
        findFirstWorking(candidatesFor(message.img)).then(url => {
          popupImage.src = url || '';
        });
      }
      popupMessage.textContent = message.text;
      popup.style.display = "block";
      overlay.classList.add("active");
      popup.dataset.currentMessage = message.text;
      currentMessageIndex = (currentMessageIndex + 1) % messages.length;
    }

    function closePopup() {
      popup.style.display = "none";
      overlay.classList.remove("active");
      if (popup.dataset.currentMessage) {
        centerText.innerHTML = popup.dataset.currentMessage;
      }
    }

    document.body.addEventListener("click", function () {
      const player = document.getElementById("player");
      if (player && player.paused && player.src) {
        // play only if src ƒë√£ set
        player.play().catch(()=>{ /* tr√¨nh duy·ªát c√≥ th·ªÉ ch·∫∑n autoplay */ });
      }
    });
    overlay.addEventListener("click", closePopup);

    // Start everything: resolve assets -> b·∫Øt interval t·∫°o ·∫£nh r∆°i
    (async function start() {
      await prepareAssets();
      // n·∫øu c√≥ ·∫£nh r∆°i th√¨ b·∫Øt interval
      if (resolvedLetterImages.length > 0) {
        setInterval(createFallingLetter, 1000);
      } else {
        // n·∫øu kh√¥ng c√≥ ·∫£nh r∆°i, v·∫´n cho n√∫t hi·ªán popup t·ª± ƒë·ªông 1 l·∫ßn ƒë·ªÉ ki·ªÉm tra
        setTimeout(() => showPopup(), 1000);
      }
    })();
  </script>
</body>
</html>
